# Customise this file, documentation can be found here:
# https://github.com/krausefx/fastlane#customise-the-fastfile

# Change the syntax highlighting to Ruby

# All lines starting with a # are ignored when running `fastlane`

# This is the minimum version number required. 
# Update this, if you use features of a newer version
fastlane_version "0.4.2" 

before_all do

end

lane :test do
  xctest(
    destination: "OS=8.1,name=iPad Air",
  )
end

lane :oss do
  keys = ['ArtsyAPIClientSecret', 
    'ArtsyAPIClientKey', 
    'HockeyProductionSecret', 
    'HockeyBetaSecret', 
    'MixpanelProductionAPIClientKey', 
    'MixpanelStagingAPIClientKey', 
    'CardflightAPIClientKey', 
    'CardflightAPIStagingClientKey', 
    'CardflightMerchantAccountToken', 
    'CardflightMerchantAccountStagingToken', 
    'BalancedMarketplaceToken', 
    'BalancedMarketplaceStagingToken']

    commands = keys.map { |key|
      command = "bundle exec pod keys set #{key} '-'"
      if key == keys.first
        command += " Eidolon"
      end

      command
    }.join(' ; ')

    sh "cd .. ; #{commands}"
end

lane :deploy do 
  ipa({
    workspace: "Kiosk.xcworkspace",
    configuration: "Release",
    scheme: "Kiosk",
    destination: "build",
    embed: "fastlane/Distribution_net.artsy.kiosk.beta.mobileprovision",
    identity: "iPhone Distribution: ART SY INC",
  })
end

# You can define as many lanes as you want

after_all do |lane|
  # This block is called, only if the executed lane was successful
  # slack({
  #   message: "Successfully deployed new App Update for [App](http://link.com).",
  #   success: true,
  #   channel: 'development'
  # })
end


error do |lane, exception|
  # Something bad happened
end